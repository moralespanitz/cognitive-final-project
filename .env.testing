# TaxiWatch End-to-End Testing Environment Configuration

# ============================================================================
# BACKEND CONFIGURATION (.env for backend container)
# ============================================================================

# Application Settings
APP_NAME=TaxiWatch API
DEBUG=True
ENVIRONMENT=development
APP_VERSION=2.0.0

# Database Configuration
DATABASE_URL=postgresql+asyncpg://postgres:postgres@localhost:5432/taxiwatch
DATABASE_ECHO=False

# Security Settings
SECRET_KEY=your-super-secret-key-change-in-production-12345
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=60
REFRESH_TOKEN_EXPIRE_DAYS=7

# CORS Configuration (Allow frontend)
CORS_ORIGINS=http://localhost:3000,http://127.0.0.1:3000,http://localhost:8000

# Redis Configuration (for caching and message broker)
REDIS_URL=redis://redis:6379/0

# AWS Configuration (Optional - for S3 storage in production)
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=

# S3 Buckets (Optional)
S3_BUCKET_FRAMES=taxiwatch-frames
S3_BUCKET_VIDEOS=taxiwatch-videos
S3_BUCKET_STATIC=taxiwatch-static

# OpenAI Configuration (REQUIRED for AI features)
# Get your API key at: https://platform.openai.com/api-keys
OPENAI_API_KEY=sk-your-actual-openai-api-key-here
OPENAI_MODEL=gpt-4o-mini
OPENAI_VISION_MODEL=gpt-4o-mini

# ============================================================================
# FRONTEND CONFIGURATION (.env.local for Next.js)
# ============================================================================

# API Configuration
NEXT_PUBLIC_API_URL=http://localhost:8000/api/v1

# Mapbox Configuration (REQUIRED for map features)
# Get your token at: https://account.mapbox.com/tokens/
NEXT_PUBLIC_MAPBOX_TOKEN=pk.your-actual-mapbox-token-here

# ============================================================================
# TEST DATA & SEEDING
# ============================================================================

# Default Test Users (created during seed_data.py)
TEST_ADMIN_USERNAME=admin
TEST_ADMIN_PASSWORD=Admin123!

TEST_MANAGER_USERNAME=manager1
TEST_MANAGER_PASSWORD=Manager123!

TEST_DRIVER_USERNAME=driver1
TEST_DRIVER_PASSWORD=Driver123!

# ============================================================================
# RUNNING THE END-TO-END TESTS
# ============================================================================

# 1. Backend Setup:
#    - Update OPENAI_API_KEY with your actual key from openai.com
#    - Place this file content in: backend/.env
#    - Run: docker-compose up -d
#    - Seed data: docker-compose exec backend python -m app.scripts.seed_data

# 2. Frontend Setup:
#    - Update NEXT_PUBLIC_MAPBOX_TOKEN with your token from mapbox.com
#    - Place this file content in: ui/.env.local
#    - Run: cd ui && pnpm dev (in separate terminal)

# 3. Test Workflow:
#    a) Login at http://localhost:3000/login
#       Username: admin
#       Password: Admin123!
#
#    b) Test Dashboard:
#       - View live GPS tracking of vehicles
#       - See real-time updates from GPS simulator
#
#    c) Test Live Map Page (/map):
#       - View all vehicles on full-screen map
#       - Filter by vehicle status
#       - Focus on specific vehicle
#       - See live updates and vehicle stats
#
#    d) Test Vehicles Page (/vehicles):
#       - Search vehicles by plate/make/model
#       - Filter by status
#       - View vehicle details and GPS history
#
#    e) Test Admin Panel (/admin):
#       - View system statistics
#       - Manage users, devices, and FAQs
#
#    f) Test Chat (/chat):
#       - Ask questions about fleet management
#       - See FAQ responses integrated
#
#    g) Test Video Analysis:
#       - Upload video frame via API
#       - See AI incident detection results
#       - Check incidents in dashboard

# ============================================================================
# KEY ENDPOINTS FOR TESTING
# ============================================================================

# Authentication
# POST /api/v1/auth/login
# POST /api/v1/auth/register
# POST /api/v1/auth/refresh

# Fleet Management
# GET /api/v1/vehicles - List all vehicles
# GET /api/v1/drivers - List all drivers
# GET /api/v1/tracking/live - Get live GPS locations

# Devices
# GET /api/v1/devices - List devices
# POST /api/v1/devices - Create device
# POST /api/v1/devices/{id}/ping - Ping device

# FAQs
# GET /api/v1/faqs - Get all FAQs (public)
# POST /api/v1/faqs - Create FAQ (admin only)
# PATCH /api/v1/faqs/{id} - Update FAQ (admin only)

# Chat & AI
# POST /api/v1/chat - Send chat message
# POST /api/v1/video/upload-and-analyze - Upload image for AI analysis

# Real-time
# WebSocket: ws://localhost:8000/ws/tracking - Live GPS updates

# ============================================================================
# TROUBLESHOOTING
# ============================================================================

# Backend not starting?
# - Check Docker: docker-compose ps
# - View logs: docker-compose logs backend
# - Verify DB connection: docker-compose logs postgres

# Frontend not showing map?
# - Verify Mapbox token is valid
# - Check browser console for errors
# - Test API connection: curl http://localhost:8000/health

# AI features not working?
# - Verify OpenAI API key is valid
# - Test: curl http://localhost:8000/docs (check if Vision endpoints exist)

# GPS simulator not sending data?
# - Check if simulator is running: ps aux | grep gps_simulator
# - Verify backend is receiving: curl http://localhost:8000/api/v1/tracking/live

# WebSocket not updating?
# - Check network tab in browser dev tools
# - Verify WebSocket connection to ws://localhost:8000/ws/tracking
